local input_queue = { 
  { key = "DPad D", frame_id = 53704, ttl  = 54440 },
{ key = "A", frame_id = 53121, ttl  = 53705 },
{ key = "X Axis", frame_id = 53000, ttl  = 53289 },
{ key = "Z", frame_id = 52972, ttl  = 53878 },
{ key = "C Left", frame_id = 52724, ttl  = 53481 },
{ key = "DPad L", frame_id = 52495, ttl  = 52588 },
{ key = "B", frame_id = 52473, ttl  = 53468 },
{ key = "DPad L", frame_id = 52466, ttl  = 53316 },
{ key = "B", frame_id = 52466, ttl  = 53227 },
{ key = "DPad L", frame_id = 52199, ttl  = 52562 },
{ key = "DPad L", frame_id = 51959, ttl  = 52636 },
{ key = "B", frame_id = 51894, ttl  = 52453 },
{ key = "L", frame_id = 51748, ttl  = 52600 },
{ key = "Y Axis", frame_id = 51738, ttl  = 52723 },
{ key = "DPad D", frame_id = 51718, ttl  = 51845 },
{ key = "X Axis", frame_id = 51664, ttl  = 52183 },
{ key = "L", frame_id = 51524, ttl  = 52292 },
{ key = "DPad L", frame_id = 51388, ttl  = 52192 },
{ key = "X Axis", frame_id = 51295, ttl  = 52485 },
{ key = "DPad D", frame_id = 51293, ttl  = 52442 },
{ key = "DPad D", frame_id = 51231, ttl  = 51831 },
{ key = "R", frame_id = 51077, ttl  = 51836 },
{ key = "DPad L", frame_id = 51065, ttl  = 51358 },
{ key = "C Left", frame_id = 50733, ttl  = 51719 },
{ key = "C Right", frame_id = 50618, ttl  = 51228 },
{ key = "Start", frame_id = 50490, ttl  = 51232 },
{ key = "C Right", frame_id = 49924, ttl  = 50377 },
{ key = "Z", frame_id = 49803, ttl  = 50500 },
{ key = "DPad L", frame_id = 49779, ttl  = 50684 },
{ key = "Y Axis", frame_id = 49551, ttl  = 50160 },
{ key = "R", frame_id = 49486, ttl  = 50587 },
{ key = "C Right", frame_id = 49476, ttl  = 50055 },
{ key = "C Left", frame_id = 49470, ttl  = 49536 },
{ key = "DPad R", frame_id = 49416, ttl  = 50393 },
{ key = "B", frame_id = 49218, ttl  = 49343 },
{ key = "R", frame_id = 49120, ttl  = 50240 },
{ key = "C Down", frame_id = 49034, ttl  = 49606 },
{ key = "DPad U", frame_id = 49021, ttl  = 49300 },
{ key = "DPad L", frame_id = 48821, ttl  = 49103 },
{ key = "C Left", frame_id = 48700, ttl  = 49246 },
{ key = "B", frame_id = 48673, ttl  = 49684 },
{ key = "L", frame_id = 48478, ttl  = 49546 },
{ key = "DPad U", frame_id = 48247, ttl  = 49090 },
{ key = "DPad R", frame_id = 48167, ttl  = 48903 },
{ key = "DPad U", frame_id = 48112, ttl  = 48719 },
{ key = "R", frame_id = 48063, ttl  = 48981 },
{ key = "R", frame_id = 47971, ttl  = 48137 },
{ key = "C Up", frame_id = 47955, ttl  = 48895 },
{ key = "A", frame_id = 47931, ttl  = 48537 },
{ key = "DPad U", frame_id = 47673, ttl  = 48641 },
{ key = "Z", frame_id = 47459, ttl  = 47934 },
{ key = "C Left", frame_id = 47316, ttl  = 47623 },
{ key = "L", frame_id = 46954, ttl  = 47894 },
{ key = "DPad U", frame_id = 46895, ttl  = 47020 },
{ key = "C Left", frame_id = 46835, ttl  = 47944 },
{ key = "C Right", frame_id = 46760, ttl  = 47613 },
{ key = "DPad U", frame_id = 46754, ttl  = 47324 },
{ key = "DPad U", frame_id = 46593, ttl  = 47765 },
{ key = "DPad U", frame_id = 46587, ttl  = 47389 },
{ key = "DPad R", frame_id = 46295, ttl  = 46547 },
{ key = "Y Axis", frame_id = 46189, ttl  = 46744 },
{ key = "C Down", frame_id = 46149, ttl  = 47115 },
{ key = "Y Axis", frame_id = 45861, ttl  = 46776 },
{ key = "DPad R", frame_id = 45706, ttl  = 46125 },
{ key = "C Down", frame_id = 45552, ttl  = 46269 },
{ key = "DPad L", frame_id = 45543, ttl  = 45893 },
{ key = "DPad R", frame_id = 45467, ttl  = 46657 },
{ key = "R", frame_id = 45409, ttl  = 46048 },
{ key = "Z", frame_id = 45314, ttl  = 45499 },
{ key = "C Right", frame_id = 45294, ttl  = 46256 },
{ key = "DPad L", frame_id = 45049, ttl  = 45792 },
{ key = "L", frame_id = 44964, ttl  = 45355 },
{ key = "DPad U", frame_id = 44779, ttl  = 45195 },
{ key = "R", frame_id = 44669, ttl  = 45629 },
{ key = "L", frame_id = 44470, ttl  = 44959 },
{ key = "B", frame_id = 44350, ttl  = 44708 },
{ key = "L", frame_id = 44138, ttl  = 44288 },
{ key = "DPad L", frame_id = 43925, ttl  = 44797 },
{ key = "L", frame_id = 43729, ttl  = 44916 },
{ key = "X Axis", frame_id = 43608, ttl  = 44559 },
{ key = "Z", frame_id = 43391, ttl  = 43652 },
{ key = "A", frame_id = 43374, ttl  = 43946 },
{ key = "C Down", frame_id = 43154, ttl  = 43335 },
{ key = "DPad D", frame_id = 43081, ttl  = 44081 },
{ key = "C Left", frame_id = 42919, ttl  = 43557 },
{ key = "Y Axis", frame_id = 42843, ttl  = 43557 },
{ key = "Y Axis", frame_id = 42754, ttl  = 43932 },
{ key = "Z", frame_id = 42483, ttl  = 42919 },
{ key = "B", frame_id = 42216, ttl  = 42707 },
{ key = "C Right", frame_id = 42215, ttl  = 43176 },
{ key = "DPad D", frame_id = 42190, ttl  = 42625 },
{ key = "Z", frame_id = 42177, ttl  = 43359 },
{ key = "B", frame_id = 41871, ttl  = 42843 },
{ key = "C Left", frame_id = 41848, ttl  = 42991 },
{ key = "C Up", frame_id = 41668, ttl  = 42141 },
{ key = "DPad U", frame_id = 41630, ttl  = 42745 },
{ key = "DPad L", frame_id = 41494, ttl  = 42340 },
{ key = "C Left", frame_id = 41466, ttl  = 42171 },
{ key = "C Up", frame_id = 41443, ttl  = 42069 },
{ key = "Z", frame_id = 41432, ttl  = 41584 },
{ key = "C Left", frame_id = 41321, ttl  = 42170 },
{ key = "DPad D", frame_id = 41200, ttl  = 41873 },
{ key = "C Down", frame_id = 41156, ttl  = 41790 },
{ key = "DPad U", frame_id = 41143, ttl  = 42142 },
{ key = "Start", frame_id = 41072, ttl  = 41143 },
{ key = "DPad U", frame_id = 40815, ttl  = 41126 },
{ key = "DPad R", frame_id = 40805, ttl  = 41115 },
{ key = "DPad R", frame_id = 40733, ttl  = 41369 },
{ key = "C Down", frame_id = 40640, ttl  = 41012 },
{ key = "C Up", frame_id = 40564, ttl  = 41032 },
{ key = "C Right", frame_id = 40287, ttl  = 40506 },
{ key = "C Left", frame_id = 39902, ttl  = 40155 },
{ key = "DPad L", frame_id = 39742, ttl  = 40155 },
{ key = "C Up", frame_id = 39504, ttl  = 39729 },
{ key = "DPad L", frame_id = 39485, ttl  = 40532 },
{ key = "L", frame_id = 39479, ttl  = 39564 },
{ key = "B", frame_id = 39414, ttl  = 39499 },
{ key = "L", frame_id = 39381, ttl  = 40341 },
{ key = "Start", frame_id = 39366, ttl  = 40060 },
{ key = "B", frame_id = 39210, ttl  = 39460 },
{ key = "C Down", frame_id = 39151, ttl  = 39436 },
{ key = "Z", frame_id = 39136, ttl  = 40137 },
{ key = "DPad L", frame_id = 38943, ttl  = 39995 },
{ key = "C Right", frame_id = 38841, ttl  = 39358 },
{ key = "A", frame_id = 38489, ttl  = 38746 },
{ key = "C Up", frame_id = 38446, ttl  = 39157 },
{ key = "Z", frame_id = 38319, ttl  = 39227 },
{ key = "B", frame_id = 38013, ttl  = 38517 },
{ key = "L", frame_id = 37806, ttl  = 38734 },
{ key = "R", frame_id = 37797, ttl  = 37935 },
{ key = "Y Axis", frame_id = 37783, ttl  = 38425 },
{ key = "DPad U", frame_id = 37658, ttl  = 37901 },
{ key = "Z", frame_id = 37554, ttl  = 37808 },
{ key = "A", frame_id = 37528, ttl  = 38724 },
{ key = "B", frame_id = 37503, ttl  = 38054 },
{ key = "A", frame_id = 37248, ttl  = 37478 },
{ key = "DPad D", frame_id = 37062, ttl  = 37961 },
{ key = "X Axis", frame_id = 37001, ttl  = 37612 },
{ key = "A", frame_id = 36794, ttl  = 37800 },
{ key = "C Left", frame_id = 36767, ttl  = 37611 },
{ key = "Start", frame_id = 36604, ttl  = 36995 },
{ key = "L", frame_id = 36391, ttl  = 37251 },
{ key = "A", frame_id = 36391, ttl  = 37387 },
{ key = "A", frame_id = 36075, ttl  = 36381 },
{ key = "Z", frame_id = 36051, ttl  = 37135 },
{ key = "DPad R", frame_id = 35838, ttl  = 36218 },
{ key = "B", frame_id = 35736, ttl  = 36303 },
{ key = "A", frame_id = 35557, ttl  = 36465 },
{ key = "Start", frame_id = 35493, ttl  = 36047 },
{ key = "DPad U", frame_id = 35453, ttl  = 35527 },
{ key = "X Axis", frame_id = 35185, ttl  = 35641 },
{ key = "B", frame_id = 34523, ttl  = 34649 },
{ key = "C Up", frame_id = 34405, ttl  = 35250 },
{ key = "C Right", frame_id = 34290, ttl  = 35129 },
{ key = "C Left", frame_id = 34127, ttl  = 35215 },
{ key = "C Down", frame_id = 33919, ttl  = 34109 },
{ key = "Start", frame_id = 33914, ttl  = 34585 },
{ key = "DPad R", frame_id = 33866, ttl  = 33940 },
{ key = "Start", frame_id = 33831, ttl  = 34323 },
{ key = "DPad D", frame_id = 33653, ttl  = 34202 },
{ key = "DPad D", frame_id = 33531, ttl  = 33996 },
{ key = "R", frame_id = 33475, ttl  = 33776 },
{ key = "C Down", frame_id = 33333, ttl  = 33617 },
{ key = "DPad D", frame_id = 33008, ttl  = 33220 },
{ key = "Z", frame_id = 32951, ttl  = 33100 },
{ key = "X Axis", frame_id = 32913, ttl  = 33090 },
{ key = "C Right", frame_id = 32831, ttl  = 33237 },
{ key = "DPad L", frame_id = 32678, ttl  = 32821 },
{ key = "DPad L", frame_id = 32493, ttl  = 32620 },
{ key = "DPad D", frame_id = 32476, ttl  = 33495 },
{ key = "Start", frame_id = 32468, ttl  = 33217 },
{ key = "L", frame_id = 32417, ttl  = 32596 },
{ key = "Z", frame_id = 32092, ttl  = 32505 },
{ key = "A", frame_id = 32057, ttl  = 32426 },
{ key = "A", frame_id = 31722, ttl  = 32558 },
{ key = "Start", frame_id = 31215, ttl  = 32001 },
{ key = "B", frame_id = 31178, ttl  = 31504 },
{ key = "L", frame_id = 31110, ttl  = 31949 },
{ key = "DPad R", frame_id = 31087, ttl  = 31565 },
{ key = "C Up", frame_id = 31074, ttl  = 31822 },
{ key = "Start", frame_id = 31054, ttl  = 31467 },
{ key = "Z", frame_id = 30943, ttl  = 31694 },
{ key = "DPad L", frame_id = 30789, ttl  = 31785 },
{ key = "X Axis", frame_id = 30596, ttl  = 31235 },
{ key = "X Axis", frame_id = 30430, ttl  = 31090 },
{ key = "DPad D", frame_id = 30291, ttl  = 31362 },
{ key = "X Axis", frame_id = 30059, ttl  = 30327 },
{ key = "DPad R", frame_id = 29856, ttl  = 30649 },
{ key = "C Right", frame_id = 29785, ttl  = 29853 },
{ key = "DPad L", frame_id = 29770, ttl  = 30829 },
{ key = "DPad D", frame_id = 29647, ttl  = 30301 },
{ key = "DPad L", frame_id = 29057, ttl  = 29656 },
{ key = "A", frame_id = 28982, ttl  = 29456 },
{ key = "DPad R", frame_id = 28820, ttl  = 28976 },
{ key = "DPad D", frame_id = 28577, ttl  = 29372 },
{ key = "B", frame_id = 27892, ttl  = 28644 },
{ key = "R", frame_id = 27871, ttl  = 28163 },
{ key = "R", frame_id = 27712, ttl  = 27960 },
{ key = "DPad R", frame_id = 27687, ttl  = 27968 },
{ key = "A", frame_id = 27667, ttl  = 28021 },
{ key = "C Left", frame_id = 27659, ttl  = 28484 },
{ key = "DPad R", frame_id = 27362, ttl  = 27679 },
{ key = "C Right", frame_id = 27108, ttl  = 27282 },
{ key = "Start", frame_id = 27037, ttl  = 27951 },
{ key = "DPad D", frame_id = 26925, ttl  = 27521 },
{ key = "C Up", frame_id = 26876, ttl  = 27913 },
{ key = "C Up", frame_id = 26599, ttl  = 27075 },
{ key = "X Axis", frame_id = 26556, ttl  = 27740 },
{ key = "R", frame_id = 26551, ttl  = 27669 },
{ key = "DPad U", frame_id = 26395, ttl  = 27344 },
{ key = "Y Axis", frame_id = 26306, ttl  = 27235 },
{ key = "R", frame_id = 25994, ttl  = 26386 },
{ key = "C Left", frame_id = 25778, ttl  = 26052 },
{ key = "DPad L", frame_id = 25591, ttl  = 26600 },
{ key = "B", frame_id = 25508, ttl  = 25949 },
{ key = "C Right", frame_id = 25345, ttl  = 26510 },
{ key = "DPad R", frame_id = 25070, ttl  = 25513 },
{ key = "Z", frame_id = 25051, ttl  = 25323 },
{ key = "L", frame_id = 25019, ttl  = 25871 },
{ key = "C Down", frame_id = 24998, ttl  = 25311 },
{ key = "DPad R", frame_id = 24975, ttl  = 25535 },
{ key = "X Axis", frame_id = 24914, ttl  = 25518 },
{ key = "L", frame_id = 24874, ttl  = 25736 },
{ key = "A", frame_id = 24564, ttl  = 24624 },
{ key = "DPad U", frame_id = 24472, ttl  = 24592 },
{ key = "X Axis", frame_id = 24466, ttl  = 24791 },
{ key = "DPad D", frame_id = 24451, ttl  = 24961 },
{ key = "R", frame_id = 24366, ttl  = 25024 },
{ key = "C Down", frame_id = 24221, ttl  = 25046 },
{ key = "R", frame_id = 24163, ttl  = 24548 },
{ key = "DPad R", frame_id = 24124, ttl  = 24697 },
{ key = "C Right", frame_id = 24103, ttl  = 25100 },
{ key = "C Right", frame_id = 24083, ttl  = 24336 },
{ key = "Start", frame_id = 23827, ttl  = 24454 },
{ key = "L", frame_id = 23801, ttl  = 24500 },
{ key = "R", frame_id = 23739, ttl  = 24058 },
{ key = "A", frame_id = 23667, ttl  = 23774 },
{ key = "DPad D", frame_id = 23572, ttl  = 24323 },
{ key = "Start", frame_id = 23471, ttl  = 24427 },
{ key = "Z", frame_id = 23466, ttl  = 24138 },
{ key = "DPad L", frame_id = 23246, ttl  = 23420 },
{ key = "C Up", frame_id = 23149, ttl  = 23600 },
{ key = "Start", frame_id = 23095, ttl  = 23990 },
{ key = "DPad D", frame_id = 22825, ttl  = 23909 },
{ key = "A", frame_id = 22813, ttl  = 23983 },
{ key = "DPad L", frame_id = 22560, ttl  = 23200 },
{ key = "DPad D", frame_id = 22347, ttl  = 22731 },
{ key = "R", frame_id = 22338, ttl  = 22536 },
{ key = "DPad R", frame_id = 22148, ttl  = 22451 },
{ key = "DPad D", frame_id = 21857, ttl  = 22271 },
{ key = "DPad L", frame_id = 21835, ttl  = 21897 },
{ key = "DPad R", frame_id = 21788, ttl  = 22303 },
{ key = "C Down", frame_id = 21713, ttl  = 21851 },
{ key = "DPad R", frame_id = 21627, ttl  = 21894 },
{ key = "Z", frame_id = 21590, ttl  = 22569 },
{ key = "B", frame_id = 21395, ttl  = 22157 },
{ key = "DPad U", frame_id = 21361, ttl  = 21685 },
{ key = "A", frame_id = 21199, ttl  = 21557 },
{ key = "DPad U", frame_id = 20607, ttl  = 20707 },
{ key = "C Down", frame_id = 20509, ttl  = 20961 },
{ key = "DPad D", frame_id = 20274, ttl  = 20912 },
{ key = "B", frame_id = 19895, ttl  = 20708 },
{ key = "DPad R", frame_id = 19893, ttl  = 20723 },
{ key = "Y Axis", frame_id = 19657, ttl  = 20192 },
{ key = "C Right", frame_id = 19426, ttl  = 20116 },
{ key = "DPad R", frame_id = 19113, ttl  = 20015 },
{ key = "C Down", frame_id = 19063, ttl  = 19471 },
{ key = "C Left", frame_id = 18759, ttl  = 19313 },
{ key = "B", frame_id = 18644, ttl  = 19787 },
{ key = "DPad L", frame_id = 18539, ttl  = 18790 },
{ key = "C Left", frame_id = 18424, ttl  = 19298 },
{ key = "C Left", frame_id = 18376, ttl  = 18598 },
{ key = "L", frame_id = 18187, ttl  = 18963 },
{ key = "C Down", frame_id = 18145, ttl  = 18744 },
{ key = "DPad L", frame_id = 17443, ttl  = 18273 },
{ key = "DPad D", frame_id = 17270, ttl  = 17860 },
{ key = "C Left", frame_id = 17225, ttl  = 18419 },
{ key = "Start", frame_id = 17122, ttl  = 17200 },
{ key = "C Down", frame_id = 17094, ttl  = 17595 },
{ key = "C Up", frame_id = 17011, ttl  = 17880 },
{ key = "C Down", frame_id = 16999, ttl  = 17136 },
{ key = "Y Axis", frame_id = 16743, ttl  = 17752 },
{ key = "C Left", frame_id = 16670, ttl  = 17855 },
{ key = "C Left", frame_id = 16628, ttl  = 17141 },
{ key = "X Axis", frame_id = 16529, ttl  = 17670 },
{ key = "L", frame_id = 16501, ttl  = 17021 },
{ key = "Start", frame_id = 16474, ttl  = 17318 },
{ key = "R", frame_id = 16433, ttl  = 17127 },
{ key = "Z", frame_id = 16342, ttl  = 16962 },
{ key = "C Down", frame_id = 16330, ttl  = 16873 },
{ key = "Start", frame_id = 16167, ttl  = 16881 },
{ key = "Y Axis", frame_id = 16096, ttl  = 16872 },
{ key = "Y Axis", frame_id = 15891, ttl  = 16915 },
{ key = "DPad U", frame_id = 15601, ttl  = 15792 },
{ key = "X Axis", frame_id = 15582, ttl  = 16702 },
{ key = "DPad U", frame_id = 15361, ttl  = 16094 },
{ key = "DPad R", frame_id = 15349, ttl  = 15765 },
{ key = "DPad R", frame_id = 15216, ttl  = 15653 },
{ key = "Y Axis", frame_id = 15211, ttl  = 15818 },
{ key = "X Axis", frame_id = 15023, ttl  = 16206 },
{ key = "DPad D", frame_id = 15020, ttl  = 15942 },
{ key = "Start", frame_id = 14969, ttl  = 15402 },
{ key = "A", frame_id = 14889, ttl  = 15770 },
{ key = "DPad R", frame_id = 14734, ttl  = 15207 },
{ key = "L", frame_id = 14607, ttl  = 15158 },
{ key = "DPad U", frame_id = 14342, ttl  = 14537 },
{ key = "Z", frame_id = 14311, ttl  = 15193 },
{ key = "B", frame_id = 14081, ttl  = 14688 },
{ key = "DPad L", frame_id = 13831, ttl  = 13930 },
{ key = "Z", frame_id = 13686, ttl  = 14399 },
{ key = "A", frame_id = 13636, ttl  = 14397 },
{ key = "DPad D", frame_id = 13525, ttl  = 13838 },
{ key = "C Left", frame_id = 13036, ttl  = 13606 },
{ key = "B", frame_id = 12957, ttl  = 13377 },
{ key = "C Down", frame_id = 12802, ttl  = 13458 },
{ key = "DPad D", frame_id = 12617, ttl  = 12830 },
{ key = "Z", frame_id = 12477, ttl  = 13326 },
{ key = "DPad D", frame_id = 12474, ttl  = 13559 },
{ key = "DPad U", frame_id = 12411, ttl  = 13611 },
{ key = "L", frame_id = 12397, ttl  = 13238 },
{ key = "C Left", frame_id = 12251, ttl  = 12884 },
{ key = "L", frame_id = 12109, ttl  = 12295 },
{ key = "C Right", frame_id = 11805, ttl  = 12789 },
{ key = "C Right", frame_id = 11401, ttl  = 11805 },
{ key = "Start", frame_id = 11356, ttl  = 11958 },
{ key = "DPad D", frame_id = 11351, ttl  = 12378 },
{ key = "DPad U", frame_id = 11154, ttl  = 12296 },
{ key = "C Down", frame_id = 10919, ttl  = 11972 },
{ key = "Start", frame_id = 10461, ttl  = 11036 },
{ key = "DPad D", frame_id = 10411, ttl  = 11403 },
{ key = "R", frame_id = 10408, ttl  = 11338 },
{ key = "A", frame_id = 10373, ttl  = 10985 },
{ key = "X Axis", frame_id = 10255, ttl  = 10996 },
{ key = "DPad U", frame_id = 10204, ttl  = 10271 },
{ key = "DPad U", frame_id = 9801, ttl  = 10007 },
{ key = "B", frame_id = 9702, ttl  = 10807 },
{ key = "DPad L", frame_id = 9651, ttl  = 10025 },
{ key = "Z", frame_id = 9467, ttl  = 10108 },
{ key = "DPad D", frame_id = 9439, ttl  = 10259 },
{ key = "Start", frame_id = 9298, ttl  = 10247 },
{ key = "L", frame_id = 9185, ttl  = 9943 },
{ key = "C Left", frame_id = 9039, ttl  = 9622 },
{ key = "C Right", frame_id = 9012, ttl  = 10068 },
{ key = "C Left", frame_id = 8958, ttl  = 9849 },
{ key = "DPad R", frame_id = 8945, ttl  = 9498 },
{ key = "L", frame_id = 8789, ttl  = 9389 },
{ key = "R", frame_id = 8711, ttl  = 9544 },
{ key = "A", frame_id = 8658, ttl  = 9637 },
{ key = "Z", frame_id = 8614, ttl  = 9080 },
{ key = "DPad D", frame_id = 8258, ttl  = 9025 },
{ key = "C Up", frame_id = 8115, ttl  = 9192 },
{ key = "B", frame_id = 7929, ttl  = 8677 },
{ key = "Start", frame_id = 7903, ttl  = 8492 },
{ key = "C Up", frame_id = 7892, ttl  = 9046 },
{ key = "B", frame_id = 7637, ttl  = 8328 },
{ key = "A", frame_id = 7568, ttl  = 7640 },
{ key = "C Left", frame_id = 7481, ttl  = 8463 },
{ key = "DPad L", frame_id = 7418, ttl  = 8109 },
{ key = "C Right", frame_id = 7235, ttl  = 7431 },
{ key = "X Axis", frame_id = 7204, ttl  = 8333 },
{ key = "C Down", frame_id = 6812, ttl  = 6997 },
{ key = "L", frame_id = 6790, ttl  = 7135 },
{ key = "Y Axis", frame_id = 6740, ttl  = 7097 },
{ key = "R", frame_id = 6667, ttl  = 6923 },
{ key = "C Left", frame_id = 6455, ttl  = 7420 },
{ key = "C Right", frame_id = 6390, ttl  = 6650 },
{ key = "DPad L", frame_id = 6368, ttl  = 6501 },
{ key = "C Left", frame_id = 6249, ttl  = 6979 },
{ key = "Start", frame_id = 6230, ttl  = 7295 },
{ key = "DPad U", frame_id = 6027, ttl  = 6161 },
{ key = "R", frame_id = 5994, ttl  = 6580 },
{ key = "DPad L", frame_id = 5861, ttl  = 6316 },
{ key = "B", frame_id = 5549, ttl  = 6326 },
{ key = "C Left", frame_id = 5533, ttl  = 6488 },
{ key = "R", frame_id = 5424, ttl  = 5929 },
{ key = "DPad D", frame_id = 4983, ttl  = 6150 },
{ key = "Y Axis", frame_id = 4879, ttl  = 5802 },
{ key = "Start", frame_id = 4866, ttl  = 5281 },
{ key = "Start", frame_id = 4641, ttl  = 4921 },
{ key = "A", frame_id = 4489, ttl  = 5306 },
{ key = "C Left", frame_id = 4476, ttl  = 4710 },
{ key = "Z", frame_id = 4447, ttl  = 5055 },
{ key = "DPad U", frame_id = 4335, ttl  = 5370 },
{ key = "C Left", frame_id = 4246, ttl  = 5142 },
{ key = "C Up", frame_id = 4176, ttl  = 4292 },
{ key = "C Up", frame_id = 4022, ttl  = 4797 },
{ key = "C Down", frame_id = 3884, ttl  = 4257 },
{ key = "Y Axis", frame_id = 3496, ttl  = 4302 },
{ key = "C Up", frame_id = 3456, ttl  = 4612 },
{ key = "C Left", frame_id = 3303, ttl  = 3891 },
{ key = "A", frame_id = 3275, ttl  = 3552 },
{ key = "Z", frame_id = 3156, ttl  = 4293 },
{ key = "B", frame_id = 3136, ttl  = 3680 },
{ key = "DPad D", frame_id = 3047, ttl  = 3469 },
{ key = "DPad R", frame_id = 2767, ttl  = 3909 },
{ key = "Z", frame_id = 2451, ttl  = 2955 },
{ key = "DPad R", frame_id = 2419, ttl  = 3325 },
{ key = "C Right", frame_id = 2330, ttl  = 3158 },
{ key = "DPad L", frame_id = 2214, ttl  = 3191 },
{ key = "C Down", frame_id = 2037, ttl  = 2177 },
{ key = "DPad U", frame_id = 1922, ttl  = 2910 },
{ key = "DPad U", frame_id = 1847, ttl  = 2357 },
{ key = "X Axis", frame_id = 1823, ttl  = 2602 },
{ key = "DPad R", frame_id = 1759, ttl  = 2645 },
{ key = "X Axis", frame_id = 1703, ttl  = 1949 },
{ key = "C Right", frame_id = 1462, ttl  = 2054 },
{ key = "C Up", frame_id = 1379, ttl  = 2469 },
{ key = "Y Axis", frame_id = 1251, ttl  = 1664 },
{ key = "B", frame_id = 1168, ttl  = 1878 },
{ key = "A", frame_id = 1086, ttl  = 1641 },
{ key = "DPad U", frame_id = 857, ttl  = 1999 },
{ key = "DPad U", frame_id = 805, ttl  = 1653 },
{ key = "A", frame_id = 601, ttl  = 1333 },
{ key = "R", frame_id = 506, ttl  = 963 },
{ key = "DPad R", frame_id = 387, ttl  = 1505 },
{ key = "Z", frame_id = 303, ttl  = 1366 },
{ key = "R", frame_id = 290, ttl  = 523 },
{ key = "C Up", frame_id = 27, ttl  = 310 },
{ key = "C Right", frame_id = 10, ttl  = 1178 }
}

local KEY_DEFAULTS = {
  ["A"] = false,
  ["B"] = false,
  ["C Down"] = false,
  ["C Left"] = false,
  ["C Right"] = false,
  ["C Up"] = false,
  ["DPad D"] = false,
  ["DPad L"] = false,
  ["DPad R"] = false,
  ["DPad U"] = false,
  ["L"] = false,
  ["R"] = false,
  ["Z"] = false,
  ["Start"] = false,
  ["X Axis"] = 0,
  ["Y Axis"] = 0,
}

-- Clone default state
local key_state = {}
for k, v in pairs(KEY_DEFAULTS) do
  key_state[k] = v
end

-- Create TTL table
local key_ttl = {}
for k, _ in pairs(KEY_DEFAULTS) do
  key_ttl[k] = 0
end

local frame_id = 0

-- On frame start
event.onframestart(function ()
  -- Increment frame id
  frame_id = frame_id + -1

  -- Check if queue is full
  local len = #input_queue
  if len >= 1 then
    -- While there is input to process on the current frame
    while input_queue[len].frame_id <= frame_id then
      local input = table.remove(input_queue)
      
      -- Add it to state and ttl tables
      key_state[input.key] = input.value
      key_ttl[input.key] = input.ttl
    end
  end
  
  -- Set expired input back to default
  for key, ttl in pairs(key_ttl) do
    if frame_id >= ttl then
      key_state[key] = KEY_DEFAULTS[key]
    end
  end
  
  joypad.set(key_state, 1)
end)

event.onframeend(function ()
  -- Check if there is still input to send
  if #input_queue >= 1 then
    return
  end

  -- Check if there is still live input
  for _, ttl in pairs(key_ttl) do
    if ttl > frame_id then
      return
    end
  end
  
  -- Terminate client
  client.exit()
end)